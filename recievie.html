<!DOCTYPE html>
<html>
<head>
  <title>Admin Orders</title>
  <style>
    body { font-family: Arial; background: #111; color: white; padding: 20px; }
    .order { background: #222; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid crimson; }
    .code-box { background: #333; padding: 10px; border-radius: 4px; font-family: monospace; color: #00ff88; margin: 10px 0; }
    button { padding: 8px 12px; border: none; cursor: pointer; border-radius: 4px; margin-right: 5px; color: white; }
    .complete-btn { background: #00aa44; }
    .delete-btn { background: #ff4444; }
    .status-pending { color: #ffaa00; }
    .status-completed { color: #00ff88; }
  </style>
</head>
<body>

<h1>ðŸ“¦ Orders Received</h1>
<button onclick="loadOrders()" style="margin-bottom: 20px; padding: 10px; background: #444; color: white; border: none; cursor: pointer;">ðŸ”„ Refresh</button>
<div id="ordersContainer"><p>Loading...</p></div>

<script>
const API_URL = 'http://localhost:3000/api/orders';

async function loadOrders() {
  const container = document.getElementById("ordersContainer");
  
  try {
    const response = await fetch(API_URL);
    const orders = await response.json();

    if (orders.length === 0) {
      container.innerHTML = "<p>No orders yet.</p>";
      return;
    }

    container.innerHTML = orders.map((order, index) => `
      <div class="order">
        <span style="background: crimson; padding: 2px 8px; border-radius: 12px; float: right;">#${index + 1}</span>
        <p><strong>Package:</strong> ${order.package}</p>
        <p><strong>UID:</strong> ${order.uid}</p>
        <p><strong>Google Play Code:</strong></p>
        <div class="code-box">${order.code}</div>
        <p><strong>Status:</strong> <span class="status-${order.status.toLowerCase()}">${order.status}</span></p>
        <p><strong>Date:</strong> ${new Date(order.date).toLocaleString()}</p>
        <button class="complete-btn" onclick="updateStatus('${order._id}', '${order.status === 'Completed' ? 'Pending' : 'Completed'}')">
          ${order.status === 'Completed' ? 'Mark Pending' : 'Mark Complete'}
        </button>
        <button class="delete-btn" onclick="deleteOrder('${order._id}')">Delete</button>
      </div>
    `).join('');
  } catch (error) {
    container.innerHTML = `<p style="color: #ff4444;">Error: ${error.message}</p>`;
  }
}

async function updateStatus(id, newStatus) {
  await fetch(`${API_URL}/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ status: newStatus })
  });
  loadOrders();
}

async function deleteOrder(id) {
  if (!confirm("Delete this order?")) return;
  await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
  loadOrders();
}

// Load on start
loadOrders();
// Auto refresh every 10 seconds
setInterval(loadOrders, 10000);
</script>

</body>
</html>
